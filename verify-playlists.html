<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Top 50 Playlists</title>
    <link rel="stylesheet" href="src/css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Verify Top 50 Playlist IDs</h1>
            <p class="subtitle">Check which Top 50 playlists are accessible</p>
        </header>

        <section class="game-setup" id="main-section">
            <div class="setup-card">
                <div class="user-info" id="user-info">
                    <span id="user-name">Not logged in</span>
                    <button id="login-button" class="btn-secondary">Login</button>
                </div>

                <button id="verify-button" class="btn-primary" disabled>Verify All Playlists</button>

                <div id="results" style="margin-top: 30px;"></div>
            </div>
        </section>
    </div>

    <script src="src/js/config.js"></script>
    <script src="src/js/spotify-client.js"></script>
    <script>
        let spotifyClient = null;

        const playlistsToVerify = {
            'Global Top 50': '37i9dQZEVXbMDoHDwVN2tF',
            'USA Top 50': '37i9dQZEVXbLRQDuF5jeBp',
            'UK Top 50': '37i9dQZEVXbLnolsZ8PSNw',
            'Sweden Top 50': '37i9dQZEVXbLoATJ81JYXz',
            'Japan Top 50': '37i9dQZEVXbKXQ4mDTEBXq',
            'Brazil Top 50': '37i9dQZEVXbMXbN3EUUhlg'
        };

        window.addEventListener('DOMContentLoaded', async () => {
            spotifyClient = new SpotifyClient();

            if (window.location.search.includes('code=')) {
                await spotifyClient.handleCallback();
                await init();
            } else if (spotifyClient.isAuthenticated()) {
                await init();
            }

            document.getElementById('login-button').addEventListener('click', async () => {
                await spotifyClient.redirectToSpotifyAuth();
            });

            document.getElementById('verify-button').addEventListener('click', verifyAll);
        });

        async function init() {
            const user = await spotifyClient.getCurrentUser();
            document.getElementById('user-name').textContent = `Logged in as ${user.display_name || user.id}`;
            document.getElementById('verify-button').disabled = false;
        }

        async function verifyAll() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h3>Verification Results:</h3>';

            for (const [name, id] of Object.entries(playlistsToVerify)) {
                const result = await verifyPlaylist(name, id);
                resultsDiv.innerHTML += result;
            }
        }

        async function verifyPlaylist(name, id) {
            try {
                const response = await fetch(`https://api.spotify.com/v1/playlists/${id}`, {
                    headers: {
                        'Authorization': `Bearer ${spotifyClient.accessToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    return `
                        <div style="padding: 10px; margin: 10px 0; background: rgba(29, 185, 84, 0.2); border: 1px solid rgba(29, 185, 84, 0.5); border-radius: 8px;">
                            <strong style="color: #1db954;">✓ ${name}</strong><br>
                            ID: <code>${id}</code><br>
                            Name: ${data.name}<br>
                            Tracks: ${data.tracks.total}<br>
                            Owner: ${data.owner.display_name}
                        </div>
                    `;
                } else {
                    return `
                        <div style="padding: 10px; margin: 10px 0; background: rgba(231, 76, 60, 0.2); border: 1px solid rgba(231, 76, 60, 0.5); border-radius: 8px;">
                            <strong style="color: #e74c3c;">✗ ${name}</strong><br>
                            ID: <code>${id}</code><br>
                            Error: ${response.status} ${response.statusText}
                        </div>
                    `;
                }
            } catch (error) {
                return `
                    <div style="padding: 10px; margin: 10px 0; background: rgba(231, 76, 60, 0.2); border: 1px solid rgba(231, 76, 60, 0.5); border-radius: 8px;">
                        <strong style="color: #e74c3c;">✗ ${name}</strong><br>
                        ID: <code>${id}</code><br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
